<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flappy Bird by Ravindra</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: skyblue;
      font-family: sans-serif;
    }

    canvas {
      display: block;
    }

    #score {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 24px;
      color: white;
      font-weight: bold;
      text-shadow: 2px 2px 4px #000;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="score">Score: 0</div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    window.addEventListener("resize", () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });

    const birdImg = new Image();
    birdImg.src = "bird.png";
    const pipeTopImg = new Image();
    pipeTopImg.src = "pipeTop.png";
    const pipeBottomImg = new Image();
    pipeBottomImg.src = "pipeBottom.png";

    const bgMusic = new Audio("music/bg-music.mp3");
    bgMusic.loop = true;
    bgMusic.volume = 0.5;

    const gameOverSound = new Audio("music/gameover.mp3");
    gameOverSound.volume = 0.8;

    const bird = {
      x: 100,
      y: canvas.height / 2,
      w: 70,
      h: 60,
      gravity: 0.25,
      jump: 4.6,
      speed: 0,
      rotation: 0,

      draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rotation);

        const radius = Math.min(this.w, this.h) / 2;
        ctx.beginPath();
        ctx.arc(0, 0, radius, 0, Math.PI * 2);
        ctx.closePath();
        ctx.clip();

        ctx.drawImage(birdImg, -this.w / 2, -this.h / 2, this.w, this.h);
        ctx.restore();

        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rotation);
        ctx.strokeStyle = "limegreen";
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.arc(0, 0, radius, 0, Math.PI * 2);
        ctx.stroke();
        ctx.restore();
      },

      flap() {
        this.speed = -this.jump;
      },

      update() {
        this.speed += this.gravity;
        this.y += this.speed;

        if (this.y + this.h / 2 >= canvas.height - 80) {
          this.y = canvas.height - 80 - this.h / 2;
          gameOver = true;
        }

        this.rotation = this.speed >= this.jump ? Math.PI / 2 : -0.4;
      },
    };

    const pipes = [];
    const pipeWidth = 80;
    const gap = 250;
    let pipeSpeed = 2;
    let score = 0;
    let gameOver = false;
    let frames = 0;

    function createPipe() {
      const topHeight = Math.random() * (canvas.height / 2);
      const bottomY = topHeight + gap;
      pipes.push({ x: canvas.width, topHeight, bottomY, scored: false });
    }

    function drawPipes() {
      for (let p of pipes) {
        // Top pipe
        let topY = p.topHeight - pipeTopImg.height;
        while (topY > -pipeTopImg.height) {
          ctx.drawImage(pipeTopImg, p.x, topY, pipeWidth, pipeTopImg.height);
          topY -= pipeTopImg.height;
        }

        // Bottom pipe
        let bottomY = p.bottomY;
        while (bottomY < canvas.height) {
          ctx.drawImage(pipeBottomImg, p.x, bottomY, pipeWidth, pipeBottomImg.height);
          bottomY += pipeBottomImg.height;
        }

        // Borders
        ctx.save();
        ctx.strokeStyle = "#064d0a";
        ctx.lineWidth = 5;
        ctx.shadowColor = "rgba(0, 100, 0, 0.6)";
        ctx.shadowBlur = 8;
        ctx.strokeRect(p.x, 0, pipeWidth, p.topHeight);
        ctx.strokeRect(p.x, p.bottomY, pipeWidth, canvas.height - p.bottomY);
        ctx.restore();
      }
    }

    function updatePipes() {
      for (let p of pipes) {
        p.x -= pipeSpeed;

        // Collision detection
        if (
          bird.x + bird.w / 2 > p.x &&
          bird.x - bird.w / 2 < p.x + pipeWidth &&
          (bird.y - bird.h / 2 < p.topHeight || bird.y + bird.h / 2 > p.bottomY)
        ) {
          gameOver = true;
        }

        // Scoring (trigger once when pipe passes bird)
        if (!p.scored && p.x + pipeWidth < bird.x) {
          p.scored = true;
          score++;
          document.getElementById("score").innerText = "Score: " + score;

          // Increase speed every 5 points
          if (score % 5 === 0) {
            pipeSpeed += 0.5;
          }

          // End game at 50 points
          if (score >= 50) {
            gameOver = true;
          }
        }
      }

      if (pipes.length && pipes[0].x + pipeWidth < 0) pipes.shift();
      if (frames % 150 === 0) createPipe();
    }

    function drawGround() {
      ctx.fillStyle = "brown";
      ctx.fillRect(0, canvas.height - 80, canvas.width, 80);
    }

    function loop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawGround();
      bird.update();
      bird.draw();
      updatePipes();
      drawPipes();

      if (!gameOver) {
        frames++;
        requestAnimationFrame(loop);
      } else {
        bgMusic.pause();
        gameOverSound.currentTime = 0;
        gameOverSound.play();

        ctx.fillStyle = "white";
        ctx.font = "40px Arial";
        ctx.fillText("Game Over!", canvas.width / 2 - 120, canvas.height / 2);

        if (score >= 50) {
          ctx.font = "24px Arial";
          ctx.fillText("ðŸŽ‰ You Won! Max Score Reached ðŸŽ‰", canvas.width / 2 - 200, canvas.height / 2 + 50);
        } else {
          ctx.font = "20px Arial";
          ctx.fillText("Press SPACE to Restart", canvas.width / 2 - 120, canvas.height / 2 + 40);
        }
      }
    }

    document.addEventListener("keydown", (e) => {
      if (e.code === "Space") {
        if (gameOver) {
          resetGame();
        } else {
          bird.flap();
          if (bgMusic.paused) {
            bgMusic.currentTime = 0;
            bgMusic.play();
          }
        }
      }
    });

    function resetGame() {
      pipes.length = 0;
      score = 0;
      pipeSpeed = 2;
      bird.y = canvas.height / 2;
      bird.speed = 0;
      gameOver = false;
      frames = 0;
      document.getElementById("score").innerText = "Score: 0";
      bgMusic.currentTime = 0;
      bgMusic.play();
      loop();
    }

    let loaded = 0;
    [birdImg, pipeTopImg, pipeBottomImg].forEach((img) => {
      img.onload = () => {
        loaded++;
        if (loaded === 3) loop();
      };
    });
  </script>
</body>
</html>
